"use strict";(()=>{var bo=Object.create;var pr=Object.defineProperty;var To=Object.getOwnPropertyDescriptor;var vo=Object.getOwnPropertyNames;var So=Object.getPrototypeOf,_o=Object.prototype.hasOwnProperty;var we=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var Eo=(r,e,o,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of vo(e))!_o.call(r,n)&&n!==o&&pr(r,n,{get:()=>e[n],enumerable:!(a=To(e,n))||a.enumerable});return r};var X=(r,e,o)=>(o=r!=null?bo(So(r)):{},Eo(e||!r||!r.__esModule?pr(o,"default",{value:r,enumerable:!0}):o,r));var dr=we((qn,mr)=>{"use strict";mr.exports=()=>{let r={};return r.promise=new Promise((e,o)=>{r.resolve=e,r.reject=o}),r}});var hr=we((zn,gr)=>{"use strict";var ko=dr();function Oo(r,e="maxAge"){let o,a,n,f=async()=>{if(o!==void 0)return;let s=async p=>{n=ko();let i=p[1][e]-Date.now();if(i<=0){r.delete(p[0]),n.resolve();return}return o=p[0],a=setTimeout(()=>{r.delete(p[0]),n&&n.resolve()},i),typeof a.unref=="function"&&a.unref(),n.promise};try{for(let p of r)await s(p)}catch{}o=void 0},d=()=>{o=void 0,a!==void 0&&(clearTimeout(a),a=void 0),n!==void 0&&(n.reject(void 0),n=void 0)},g=r.set.bind(r);return r.set=(s,p)=>{r.has(s)&&r.delete(s);let i=g(s,p);return o&&o===s&&d(),f(),i},f(),r}gr.exports=Oo});var Vt=we((Hn,xr)=>{"use strict";var Mo=hr(),Jt=class{constructor(e,o){if(this.maxAge=e,this[Symbol.toStringTag]="Map",this.data=new Map,Mo(this.data),o)for(let[a,n]of o)this.set(a,n)}get size(){return this.data.size}clear(){this.data.clear()}delete(e){return this.data.delete(e)}has(e){return this.data.has(e)}get(e){let o=this.data.get(e);if(o)return o.data}set(e,o){return this.data.set(e,{maxAge:Date.now()+this.maxAge,data:o}),this}values(){return this.createIterator(e=>e[1].data)}keys(){return this.data.keys()}entries(){return this.createIterator(e=>[e[0],e[1].data])}forEach(e,o){for(let[a,n]of this.entries())e.apply(o,[n,a,this])}[Symbol.iterator](){return this.entries()}*createIterator(e){for(let o of this.data.entries())yield e(o)}};xr.exports=Jt});var ne=we((Kt,yr)=>{(function(r,e){if(typeof define=="function"&&define.amd)define("webextension-polyfill",["module"],e);else if(typeof Kt<"u")e(yr);else{var o={exports:{}};e(o),r.browser=o.exports}})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:Kt,function(r){"use strict";if(!globalThis.chrome?.runtime?.id)throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){let e="The message port closed before a response was received.",o=a=>{let n={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(n).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class f extends WeakMap{constructor(A,O=void 0){super(O),this.createItem=A}get(A){return this.has(A)||this.set(A,this.createItem(A)),super.get(A)}}let d=h=>h&&typeof h=="object"&&typeof h.then=="function",g=(h,A)=>(...O)=>{a.runtime.lastError?h.reject(new Error(a.runtime.lastError.message)):A.singleCallbackArg||O.length<=1&&A.singleCallbackArg!==!1?h.resolve(O[0]):h.resolve(O)},s=h=>h==1?"argument":"arguments",p=(h,A)=>function(y,...I){if(I.length<A.minArgs)throw new Error(`Expected at least ${A.minArgs} ${s(A.minArgs)} for ${h}(), got ${I.length}`);if(I.length>A.maxArgs)throw new Error(`Expected at most ${A.maxArgs} ${s(A.maxArgs)} for ${h}(), got ${I.length}`);return new Promise((L,H)=>{if(A.fallbackToNoCallback)try{y[h](...I,g({resolve:L,reject:H},A))}catch(R){console.warn(`${h} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,R),y[h](...I),A.fallbackToNoCallback=!1,A.noCallback=!0,L()}else A.noCallback?(y[h](...I),L()):y[h](...I,g({resolve:L,reject:H},A))})},i=(h,A,O)=>new Proxy(A,{apply(y,I,L){return O.call(I,h,...L)}}),l=Function.call.bind(Object.prototype.hasOwnProperty),x=(h,A={},O={})=>{let y=Object.create(null),I={has(H,R){return R in h||R in y},get(H,R,J){if(R in y)return y[R];if(!(R in h))return;let D=h[R];if(typeof D=="function")if(typeof A[R]=="function")D=i(h,h[R],A[R]);else if(l(O,R)){let Y=p(R,O[R]);D=i(h,h[R],Y)}else D=D.bind(h);else if(typeof D=="object"&&D!==null&&(l(A,R)||l(O,R)))D=x(D,A[R],O[R]);else if(l(O,"*"))D=x(D,A[R],O["*"]);else return Object.defineProperty(y,R,{configurable:!0,enumerable:!0,get(){return h[R]},set(Y){h[R]=Y}}),D;return y[R]=D,D},set(H,R,J,D){return R in y?y[R]=J:h[R]=J,!0},defineProperty(H,R,J){return Reflect.defineProperty(y,R,J)},deleteProperty(H,R){return Reflect.deleteProperty(y,R)}},L=Object.create(h);return new Proxy(L,I)},T=h=>({addListener(A,O,...y){A.addListener(h.get(O),...y)},hasListener(A,O){return A.hasListener(h.get(O))},removeListener(A,O){A.removeListener(h.get(O))}}),w=new f(h=>typeof h!="function"?h:function(O){let y=x(O,{},{getContent:{minArgs:0,maxArgs:0}});h(y)}),P=new f(h=>typeof h!="function"?h:function(O,y,I){let L=!1,H,R=new Promise(ae=>{H=function(V){L=!0,ae(V)}}),J;try{J=h(O,y,H)}catch(ae){J=Promise.reject(ae)}let D=J!==!0&&d(J);if(J!==!0&&!D&&!L)return!1;let Y=ae=>{ae.then(V=>{I(V)},V=>{let he;V&&(V instanceof Error||typeof V.message=="string")?he=V.message:he="An unexpected error occurred",I({__mozWebExtensionPolyfillReject__:!0,message:he})}).catch(V=>{console.error("Failed to send onMessage rejected reply",V)})};return Y(D?J:R),!0}),C=({reject:h,resolve:A},O)=>{a.runtime.lastError?a.runtime.lastError.message===e?A():h(new Error(a.runtime.lastError.message)):O&&O.__mozWebExtensionPolyfillReject__?h(new Error(O.message)):A(O)},M=(h,A,O,...y)=>{if(y.length<A.minArgs)throw new Error(`Expected at least ${A.minArgs} ${s(A.minArgs)} for ${h}(), got ${y.length}`);if(y.length>A.maxArgs)throw new Error(`Expected at most ${A.maxArgs} ${s(A.maxArgs)} for ${h}(), got ${y.length}`);return new Promise((I,L)=>{let H=C.bind(null,{resolve:I,reject:L});y.push(H),O.sendMessage(...y)})},_={devtools:{network:{onRequestFinished:T(w)}},runtime:{onMessage:T(P),onMessageExternal:T(P),sendMessage:M.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:M.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},j={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return n.privacy={network:{"*":j},services:{"*":j},websites:{"*":j}},x(a,_,n)};r.exports=o(chrome)}else r.exports=globalThis.browser})});var lo=we((rl,Gt)=>{(function(){"use strict";var r="input is invalid type",e="finalize already called",o=typeof window=="object",a=o?window:{};a.JS_SHA3_NO_WINDOW&&(o=!1);var n=!o&&typeof self=="object",f=!a.JS_SHA3_NO_NODE_JS&&typeof process=="object"&&process.versions&&process.versions.node;f?a=global:n&&(a=self);for(var d=!a.JS_SHA3_NO_COMMON_JS&&typeof Gt=="object"&&Gt.exports,g=typeof define=="function"&&define.amd,s=!a.JS_SHA3_NO_ARRAY_BUFFER&&typeof ArrayBuffer<"u",p="0123456789abcdef".split(""),i=[31,7936,2031616,520093696],l=[4,1024,262144,67108864],x=[1,256,65536,16777216],T=[6,1536,393216,100663296],w=[0,8,16,24],P=[1,0,32898,0,32906,2147483648,2147516416,2147483648,32907,0,2147483649,0,2147516545,2147483648,32777,2147483648,138,0,136,0,2147516425,0,2147483658,0,2147516555,0,139,2147483648,32905,2147483648,32771,2147483648,32770,2147483648,128,2147483648,32778,0,2147483658,2147483648,2147516545,2147483648,32896,2147483648,2147483649,0,2147516424,2147483648],C=[224,256,384,512],M=[128,256],_=["hex","buffer","arrayBuffer","array","digest"],j={128:168,256:136},h=a.JS_SHA3_NO_NODE_JS||!Array.isArray?function(t){return Object.prototype.toString.call(t)==="[object Array]"}:Array.isArray,A=s&&(a.JS_SHA3_NO_ARRAY_BUFFER_IS_VIEW||!ArrayBuffer.isView)?function(t){return typeof t=="object"&&t.buffer&&t.buffer.constructor===ArrayBuffer}:ArrayBuffer.isView,O=function(t){var u=typeof t;if(u==="string")return[t,!0];if(u!=="object"||t===null)throw new Error(r);if(s&&t.constructor===ArrayBuffer)return[new Uint8Array(t),!1];if(!h(t)&&!A(t))throw new Error(r);return[t,!1]},y=function(t){return O(t)[0].length===0},I=function(t){for(var u=[],c=0;c<t.length;++c)u[c]=t[c];return u},L=function(t,u,c){return function(m){return new F(t,u,t).update(m)[c]()}},H=function(t,u,c){return function(m,b){return new F(t,u,b).update(m)[c]()}},R=function(t,u,c){return function(m,b,v,E){return Z["cshake"+t].update(m,b,v,E)[c]()}},J=function(t,u,c){return function(m,b,v,E){return Z["kmac"+t].update(m,b,v,E)[c]()}},D=function(t,u,c,m){for(var b=0;b<_.length;++b){var v=_[b];t[v]=u(c,m,v)}return t},Y=function(t,u){var c=L(t,u,"hex");return c.create=function(){return new F(t,u,t)},c.update=function(m){return c.create().update(m)},D(c,L,t,u)},ae=function(t,u){var c=H(t,u,"hex");return c.create=function(m){return new F(t,u,m)},c.update=function(m,b){return c.create(b).update(m)},D(c,H,t,u)},V=function(t,u){var c=j[t],m=R(t,u,"hex");return m.create=function(b,v,E){return y(v)&&y(E)?Z["shake"+t].create(b):new F(t,u,b).bytepad([v,E],c)},m.update=function(b,v,E,S){return m.create(v,E,S).update(b)},D(m,R,t,u)},he=function(t,u){var c=j[t],m=J(t,u,"hex");return m.create=function(b,v,E){return new Ht(t,u,v).bytepad(["KMAC",E],c).bytepad([b],c)},m.update=function(b,v,E,S){return m.create(b,E,S).update(v)},D(m,J,t,u)},fr=[{name:"keccak",padding:x,bits:C,createMethod:Y},{name:"sha3",padding:T,bits:C,createMethod:Y},{name:"shake",padding:i,bits:M,createMethod:ae},{name:"cshake",padding:l,bits:M,createMethod:V},{name:"kmac",padding:l,bits:M,createMethod:he}],Z={},xe=[],re=0;re<fr.length;++re)for(var ue=fr[re],Me=ue.bits,ye=0;ye<Me.length;++ye){var zt=ue.name+"_"+Me[ye];if(xe.push(zt),Z[zt]=ue.createMethod(Me[ye],ue.padding),ue.name!=="sha3"){var cr=ue.name+Me[ye];xe.push(cr),Z[cr]=Z[zt]}}function F(t,u,c){this.blocks=[],this.s=[],this.padding=u,this.outputBits=c,this.reset=!0,this.finalized=!1,this.block=0,this.start=0,this.blockCount=1600-(t<<1)>>5,this.byteCount=this.blockCount<<2,this.outputBlocks=c>>5,this.extraBytes=(c&31)>>3;for(var m=0;m<50;++m)this.s[m]=0}F.prototype.update=function(t){if(this.finalized)throw new Error(e);var u=O(t);t=u[0];for(var c=u[1],m=this.blocks,b=this.byteCount,v=t.length,E=this.blockCount,S=0,$=this.s,k,B;S<v;){if(this.reset)for(this.reset=!1,m[0]=this.block,k=1;k<E+1;++k)m[k]=0;if(c)for(k=this.start;S<v&&k<b;++S)B=t.charCodeAt(S),B<128?m[k>>2]|=B<<w[k++&3]:B<2048?(m[k>>2]|=(192|B>>6)<<w[k++&3],m[k>>2]|=(128|B&63)<<w[k++&3]):B<55296||B>=57344?(m[k>>2]|=(224|B>>12)<<w[k++&3],m[k>>2]|=(128|B>>6&63)<<w[k++&3],m[k>>2]|=(128|B&63)<<w[k++&3]):(B=65536+((B&1023)<<10|t.charCodeAt(++S)&1023),m[k>>2]|=(240|B>>18)<<w[k++&3],m[k>>2]|=(128|B>>12&63)<<w[k++&3],m[k>>2]|=(128|B>>6&63)<<w[k++&3],m[k>>2]|=(128|B&63)<<w[k++&3]);else for(k=this.start;S<v&&k<b;++S)m[k>>2]|=t[S]<<w[k++&3];if(this.lastByteIndex=k,k>=b){for(this.start=k-b,this.block=m[E],k=0;k<E;++k)$[k]^=m[k];Ae($),this.reset=!0}else this.start=k}return this},F.prototype.encode=function(t,u){var c=t&255,m=1,b=[c];for(t=t>>8,c=t&255;c>0;)b.unshift(c),t=t>>8,c=t&255,++m;return u?b.push(m):b.unshift(m),this.update(b),b.length},F.prototype.encodeString=function(t){var u=O(t);t=u[0];var c=u[1],m=0,b=t.length;if(c)for(var v=0;v<t.length;++v){var E=t.charCodeAt(v);E<128?m+=1:E<2048?m+=2:E<55296||E>=57344?m+=3:(E=65536+((E&1023)<<10|t.charCodeAt(++v)&1023),m+=4)}else m=b;return m+=this.encode(m*8),this.update(t),m},F.prototype.bytepad=function(t,u){for(var c=this.encode(u),m=0;m<t.length;++m)c+=this.encodeString(t[m]);var b=(u-c%u)%u,v=[];return v.length=b,this.update(v),this},F.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var t=this.blocks,u=this.lastByteIndex,c=this.blockCount,m=this.s;if(t[u>>2]|=this.padding[u&3],this.lastByteIndex===this.byteCount)for(t[0]=t[c],u=1;u<c+1;++u)t[u]=0;for(t[c-1]|=2147483648,u=0;u<c;++u)m[u]^=t[u];Ae(m)}},F.prototype.toString=F.prototype.hex=function(){this.finalize();for(var t=this.blockCount,u=this.s,c=this.outputBlocks,m=this.extraBytes,b=0,v=0,E="",S;v<c;){for(b=0;b<t&&v<c;++b,++v)S=u[b],E+=p[S>>4&15]+p[S&15]+p[S>>12&15]+p[S>>8&15]+p[S>>20&15]+p[S>>16&15]+p[S>>28&15]+p[S>>24&15];v%t===0&&(u=I(u),Ae(u),b=0)}return m&&(S=u[b],E+=p[S>>4&15]+p[S&15],m>1&&(E+=p[S>>12&15]+p[S>>8&15]),m>2&&(E+=p[S>>20&15]+p[S>>16&15])),E},F.prototype.arrayBuffer=function(){this.finalize();var t=this.blockCount,u=this.s,c=this.outputBlocks,m=this.extraBytes,b=0,v=0,E=this.outputBits>>3,S;m?S=new ArrayBuffer(c+1<<2):S=new ArrayBuffer(E);for(var $=new Uint32Array(S);v<c;){for(b=0;b<t&&v<c;++b,++v)$[v]=u[b];v%t===0&&(u=I(u),Ae(u))}return m&&($[v]=u[b],S=S.slice(0,E)),S},F.prototype.buffer=F.prototype.arrayBuffer,F.prototype.digest=F.prototype.array=function(){this.finalize();for(var t=this.blockCount,u=this.s,c=this.outputBlocks,m=this.extraBytes,b=0,v=0,E=[],S,$;v<c;){for(b=0;b<t&&v<c;++b,++v)S=v<<2,$=u[b],E[S]=$&255,E[S+1]=$>>8&255,E[S+2]=$>>16&255,E[S+3]=$>>24&255;v%t===0&&(u=I(u),Ae(u))}return m&&(S=v<<2,$=u[b],E[S]=$&255,m>1&&(E[S+1]=$>>8&255),m>2&&(E[S+2]=$>>16&255)),E};function Ht(t,u,c){F.call(this,t,u,c)}Ht.prototype=new F,Ht.prototype.finalize=function(){return this.encode(this.outputBits,!0),F.prototype.finalize.call(this)};var Ae=function(t){var u,c,m,b,v,E,S,$,k,B,Re,Ie,Pe,Ce,Ne,je,De,Be,Ue,Le,Fe,$e,Ge,We,qe,ze,He,Je,Ve,Ke,Ye,Ze,Xe,Qe,et,tt,rt,ot,at,nt,st,it,lt,ut,ft,ct,pt,mt,dt,gt,ht,xt,yt,At,wt,bt,Tt,vt,St,_t,Et,kt,Ot;for(m=0;m<48;m+=2)b=t[0]^t[10]^t[20]^t[30]^t[40],v=t[1]^t[11]^t[21]^t[31]^t[41],E=t[2]^t[12]^t[22]^t[32]^t[42],S=t[3]^t[13]^t[23]^t[33]^t[43],$=t[4]^t[14]^t[24]^t[34]^t[44],k=t[5]^t[15]^t[25]^t[35]^t[45],B=t[6]^t[16]^t[26]^t[36]^t[46],Re=t[7]^t[17]^t[27]^t[37]^t[47],Ie=t[8]^t[18]^t[28]^t[38]^t[48],Pe=t[9]^t[19]^t[29]^t[39]^t[49],u=Ie^(E<<1|S>>>31),c=Pe^(S<<1|E>>>31),t[0]^=u,t[1]^=c,t[10]^=u,t[11]^=c,t[20]^=u,t[21]^=c,t[30]^=u,t[31]^=c,t[40]^=u,t[41]^=c,u=b^($<<1|k>>>31),c=v^(k<<1|$>>>31),t[2]^=u,t[3]^=c,t[12]^=u,t[13]^=c,t[22]^=u,t[23]^=c,t[32]^=u,t[33]^=c,t[42]^=u,t[43]^=c,u=E^(B<<1|Re>>>31),c=S^(Re<<1|B>>>31),t[4]^=u,t[5]^=c,t[14]^=u,t[15]^=c,t[24]^=u,t[25]^=c,t[34]^=u,t[35]^=c,t[44]^=u,t[45]^=c,u=$^(Ie<<1|Pe>>>31),c=k^(Pe<<1|Ie>>>31),t[6]^=u,t[7]^=c,t[16]^=u,t[17]^=c,t[26]^=u,t[27]^=c,t[36]^=u,t[37]^=c,t[46]^=u,t[47]^=c,u=B^(b<<1|v>>>31),c=Re^(v<<1|b>>>31),t[8]^=u,t[9]^=c,t[18]^=u,t[19]^=c,t[28]^=u,t[29]^=c,t[38]^=u,t[39]^=c,t[48]^=u,t[49]^=c,Ce=t[0],Ne=t[1],ct=t[11]<<4|t[10]>>>28,pt=t[10]<<4|t[11]>>>28,Je=t[20]<<3|t[21]>>>29,Ve=t[21]<<3|t[20]>>>29,_t=t[31]<<9|t[30]>>>23,Et=t[30]<<9|t[31]>>>23,it=t[40]<<18|t[41]>>>14,lt=t[41]<<18|t[40]>>>14,Qe=t[2]<<1|t[3]>>>31,et=t[3]<<1|t[2]>>>31,je=t[13]<<12|t[12]>>>20,De=t[12]<<12|t[13]>>>20,mt=t[22]<<10|t[23]>>>22,dt=t[23]<<10|t[22]>>>22,Ke=t[33]<<13|t[32]>>>19,Ye=t[32]<<13|t[33]>>>19,kt=t[42]<<2|t[43]>>>30,Ot=t[43]<<2|t[42]>>>30,At=t[5]<<30|t[4]>>>2,wt=t[4]<<30|t[5]>>>2,tt=t[14]<<6|t[15]>>>26,rt=t[15]<<6|t[14]>>>26,Be=t[25]<<11|t[24]>>>21,Ue=t[24]<<11|t[25]>>>21,gt=t[34]<<15|t[35]>>>17,ht=t[35]<<15|t[34]>>>17,Ze=t[45]<<29|t[44]>>>3,Xe=t[44]<<29|t[45]>>>3,We=t[6]<<28|t[7]>>>4,qe=t[7]<<28|t[6]>>>4,bt=t[17]<<23|t[16]>>>9,Tt=t[16]<<23|t[17]>>>9,ot=t[26]<<25|t[27]>>>7,at=t[27]<<25|t[26]>>>7,Le=t[36]<<21|t[37]>>>11,Fe=t[37]<<21|t[36]>>>11,xt=t[47]<<24|t[46]>>>8,yt=t[46]<<24|t[47]>>>8,ut=t[8]<<27|t[9]>>>5,ft=t[9]<<27|t[8]>>>5,ze=t[18]<<20|t[19]>>>12,He=t[19]<<20|t[18]>>>12,vt=t[29]<<7|t[28]>>>25,St=t[28]<<7|t[29]>>>25,nt=t[38]<<8|t[39]>>>24,st=t[39]<<8|t[38]>>>24,$e=t[48]<<14|t[49]>>>18,Ge=t[49]<<14|t[48]>>>18,t[0]=Ce^~je&Be,t[1]=Ne^~De&Ue,t[10]=We^~ze&Je,t[11]=qe^~He&Ve,t[20]=Qe^~tt&ot,t[21]=et^~rt&at,t[30]=ut^~ct&mt,t[31]=ft^~pt&dt,t[40]=At^~bt&vt,t[41]=wt^~Tt&St,t[2]=je^~Be&Le,t[3]=De^~Ue&Fe,t[12]=ze^~Je&Ke,t[13]=He^~Ve&Ye,t[22]=tt^~ot&nt,t[23]=rt^~at&st,t[32]=ct^~mt&gt,t[33]=pt^~dt&ht,t[42]=bt^~vt&_t,t[43]=Tt^~St&Et,t[4]=Be^~Le&$e,t[5]=Ue^~Fe&Ge,t[14]=Je^~Ke&Ze,t[15]=Ve^~Ye&Xe,t[24]=ot^~nt&it,t[25]=at^~st&lt,t[34]=mt^~gt&xt,t[35]=dt^~ht&yt,t[44]=vt^~_t&kt,t[45]=St^~Et&Ot,t[6]=Le^~$e&Ce,t[7]=Fe^~Ge&Ne,t[16]=Ke^~Ze&We,t[17]=Ye^~Xe&qe,t[26]=nt^~it&Qe,t[27]=st^~lt&et,t[36]=gt^~xt&ut,t[37]=ht^~yt&ft,t[46]=_t^~kt&At,t[47]=Et^~Ot&wt,t[8]=$e^~Ce&je,t[9]=Ge^~Ne&De,t[18]=Ze^~We&ze,t[19]=Xe^~qe&He,t[28]=it^~Qe&tt,t[29]=lt^~et&rt,t[38]=xt^~ut&ct,t[39]=yt^~ft&pt,t[48]=kt^~At&bt,t[49]=Ot^~wt&Tt,t[0]^=P[m],t[1]^=P[m+1]};if(d)Gt.exports=Z;else{for(re=0;re<xe.length;++re)a[xe[re]]=Z[xe[re]];g&&define(function(){return Z})}})()});var wo=X(Vt()),U=X(ne());async function Ar(r,e,o,a){return fetch(`https://chat.openai.com/backend-api${o}`,{method:e,headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:a===void 0?void 0:JSON.stringify(a)})}async function Yt(r){return(await Ar(r,"GET","/models").then(o=>o.json())).models}async function wr(r){try{return(await Yt(r))[0].slug}catch(e){return console.error(e),"text-davinci-002-render"}}async function br(r,e,o){await Ar(r,"PATCH",`/conversation/${e}`,o)}var Ro=typeof global=="object"&&global&&global.Object===Object&&global,Mt=Ro;var Io=typeof self=="object"&&self&&self.Object===Object&&self,Po=Mt||Io||Function("return this")(),z=Po;var Co=z.Symbol,fe=Co;var Tr=Object.prototype,No=Tr.hasOwnProperty,jo=Tr.toString,be=fe?fe.toStringTag:void 0;function Do(r){var e=No.call(r,be),o=r[be];try{r[be]=void 0;var a=!0}catch{}var n=jo.call(r);return a&&(e?r[be]=o:delete r[be]),n}var vr=Do;var Bo=Object.prototype,Uo=Bo.toString;function Lo(r){return Uo.call(r)}var Sr=Lo;var Fo="[object Null]",$o="[object Undefined]",_r=fe?fe.toStringTag:void 0;function Go(r){return r==null?r===void 0?$o:Fo:_r&&_r in Object(r)?vr(r):Sr(r)}var Q=Go;function Wo(r){return r!=null&&typeof r=="object"}var ce=Wo;var qo=Array.isArray,Er=qo;function zo(r){var e=typeof r;return r!=null&&(e=="object"||e=="function")}var Rt=zo;var Ho="[object AsyncFunction]",Jo="[object Function]",Vo="[object GeneratorFunction]",Ko="[object Proxy]";function Yo(r){if(!Rt(r))return!1;var e=Q(r);return e==Jo||e==Vo||e==Ho||e==Ko}var It=Yo;var Zo=z["__core-js_shared__"],Pt=Zo;var kr=function(){var r=/[^.]+$/.exec(Pt&&Pt.keys&&Pt.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}();function Xo(r){return!!kr&&kr in r}var Or=Xo;var Qo=Function.prototype,ea=Qo.toString;function ta(r){if(r!=null){try{return ea.call(r)}catch{}try{return r+""}catch{}}return""}var ee=ta;var ra=/[\\^$.*+?()[\]{}|]/g,oa=/^\[object .+?Constructor\]$/,aa=Function.prototype,na=Object.prototype,sa=aa.toString,ia=na.hasOwnProperty,la=RegExp("^"+sa.call(ia).replace(ra,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function ua(r){if(!Rt(r)||Or(r))return!1;var e=It(r)?la:oa;return e.test(ee(r))}var Mr=ua;function fa(r,e){return r?.[e]}var Rr=fa;function ca(r,e){var o=Rr(r,e);return Mr(o)?o:void 0}var K=ca;var pa=K(z,"WeakMap"),Ct=pa;var ma=9007199254740991;function da(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=ma}var Nt=da;function ga(r){return r!=null&&Nt(r.length)&&!It(r)}var Ir=ga;var ha=Object.prototype;function xa(r){var e=r&&r.constructor,o=typeof e=="function"&&e.prototype||ha;return r===o}var jt=xa;var ya="[object Arguments]";function Aa(r){return ce(r)&&Q(r)==ya}var Zt=Aa;var Pr=Object.prototype,wa=Pr.hasOwnProperty,ba=Pr.propertyIsEnumerable,Ta=Zt(function(){return arguments}())?Zt:function(r){return ce(r)&&wa.call(r,"callee")&&!ba.call(r,"callee")},Cr=Ta;function va(){return!1}var Nr=va;var Br=typeof exports=="object"&&exports&&!exports.nodeType&&exports,jr=Br&&typeof module=="object"&&module&&!module.nodeType&&module,Sa=jr&&jr.exports===Br,Dr=Sa?z.Buffer:void 0,_a=Dr?Dr.isBuffer:void 0,Ea=_a||Nr,Ur=Ea;var ka="[object Arguments]",Oa="[object Array]",Ma="[object Boolean]",Ra="[object Date]",Ia="[object Error]",Pa="[object Function]",Ca="[object Map]",Na="[object Number]",ja="[object Object]",Da="[object RegExp]",Ba="[object Set]",Ua="[object String]",La="[object WeakMap]",Fa="[object ArrayBuffer]",$a="[object DataView]",Ga="[object Float32Array]",Wa="[object Float64Array]",qa="[object Int8Array]",za="[object Int16Array]",Ha="[object Int32Array]",Ja="[object Uint8Array]",Va="[object Uint8ClampedArray]",Ka="[object Uint16Array]",Ya="[object Uint32Array]",N={};N[Ga]=N[Wa]=N[qa]=N[za]=N[Ha]=N[Ja]=N[Va]=N[Ka]=N[Ya]=!0;N[ka]=N[Oa]=N[Fa]=N[Ma]=N[$a]=N[Ra]=N[Ia]=N[Pa]=N[Ca]=N[Na]=N[ja]=N[Da]=N[Ba]=N[Ua]=N[La]=!1;function Za(r){return ce(r)&&Nt(r.length)&&!!N[Q(r)]}var Lr=Za;function Xa(r){return function(e){return r(e)}}var Fr=Xa;var $r=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Te=$r&&typeof module=="object"&&module&&!module.nodeType&&module,Qa=Te&&Te.exports===$r,Xt=Qa&&Mt.process,en=function(){try{var r=Te&&Te.require&&Te.require("util").types;return r||Xt&&Xt.binding&&Xt.binding("util")}catch{}}(),Qt=en;var Gr=Qt&&Qt.isTypedArray,tn=Gr?Fr(Gr):Lr,Wr=tn;function rn(r,e){return function(o){return r(e(o))}}var qr=rn;var on=qr(Object.keys,Object),zr=on;var an=Object.prototype,nn=an.hasOwnProperty;function sn(r){if(!jt(r))return zr(r);var e=[];for(var o in Object(r))nn.call(r,o)&&o!="constructor"&&e.push(o);return e}var Hr=sn;var ln=K(z,"Map"),Dt=ln;var un=K(z,"DataView"),Bt=un;var fn=K(z,"Promise"),Ut=fn;var cn=K(z,"Set"),Lt=cn;var Jr="[object Map]",pn="[object Object]",Vr="[object Promise]",Kr="[object Set]",Yr="[object WeakMap]",Zr="[object DataView]",mn=ee(Bt),dn=ee(Dt),gn=ee(Ut),hn=ee(Lt),xn=ee(Ct),se=Q;(Bt&&se(new Bt(new ArrayBuffer(1)))!=Zr||Dt&&se(new Dt)!=Jr||Ut&&se(Ut.resolve())!=Vr||Lt&&se(new Lt)!=Kr||Ct&&se(new Ct)!=Yr)&&(se=function(r){var e=Q(r),o=e==pn?r.constructor:void 0,a=o?ee(o):"";if(a)switch(a){case mn:return Zr;case dn:return Jr;case gn:return Vr;case hn:return Kr;case xn:return Yr}return e});var Xr=se;var yn="[object Map]",An="[object Set]",wn=Object.prototype,bn=wn.hasOwnProperty;function Tn(r){if(r==null)return!0;if(Ir(r)&&(Er(r)||typeof r=="string"||typeof r.splice=="function"||Ur(r)||Wr(r)||Cr(r)))return!r.length;var e=Xr(r);if(e==yn||e==An)return!r.size;if(jt(r))return!Hr(r).length;for(var o in r)if(bn.call(r,o))return!1;return!0}var pe=Tn;var vn=X(ne()),Qr=8;var eo=30,to=7;var ro="%%SUMMARY_DONE%%";var G=(i=>(i.TLDR="tldr",i.Article="article",i.BulletPoints="bulletpoints",i.LayeredBulletPoints="layeredbulletpoints",i.MergeArticles="merge articles",i.MergeTldr="merge tldr",i.ContinueSummary="continue summary",i.Tweets="tweets",i.Script="Short Video",i.Custom="Custom prompt",i))(G||{});var Ft={Auto:"this is a title",Arabic:"\u0647\u0630\u0627 \u0647\u0648 \u0627\u0644\u0639\u0646\u0648\u0627\u0646",Chinese:"\u8FD9\u662F\u4E00\u4E2A\u6807\u9898",Czech:"toto je nadpis",English:"this is a title",French:"c'est un titre",German:"das ist ein Titel",Hindi:"\u092F\u0939 \u090F\u0915 \u0936\u0940\u0930\u094D\u0937\u0915 \u0939\u0948",Italian:"questo \xE8 un titolo",Indonesian:"ini adalah judul",Japanese:"\u3053\u308C\u306F\u30BF\u30A4\u30C8\u30EB\u3067\u3059",Korean:"\uC774\uAC83\uC740 \uC81C\uBAA9\uC785\uB2C8\uB2E4",Portuguese:"este \xE9 um t\xEDtulo",Russian:"\u044D\u0442\u043E \u0437\u0430\u0433\u043E\u043B\u043E\u0432\u043E\u043A",Spanish:"este es un t\xEDtulo",Turkish:"bu bir ba\u015Fl\u0131k",Malay:"ini adalah tajuk",Urdu:"\u06CC\u06C1 \u0627\u06CC\u06A9 \u0639\u0646\u0648\u0627\u0646 \u06C1\u06D2\u06D4",Vietnamese:"\u0111\xE2y l\xE0 m\u1ED9t ti\xEAu \u0111\u1EC1"},te={Auto:"Auto",Arabic:"Arabic",Chinese:"Chinese",English:"English",French:"French",German:"German",Hindi:"Hindi",Italian:"Italian",Indonesian:"Indonesian",Japanese:"Japanese",Korean:"Korean",Portuguese:"Portuguese",Russian:"Russian",Spanish:"Spanish",Turkish:"Turkish","Chinese (Traditional)":"Chinese (Traditional)",Malay:"Malay",Ukranian:"Ukranian",Urdu:"Urdu",Czech:"Czech",Vietnamese:"Vietnamese"},Ui=te.Auto;var mo=X(Vt());var $t,Sn=new Uint8Array(16);function er(){if(!$t&&($t=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!$t))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return $t(Sn)}var q=[];for(let r=0;r<256;++r)q.push((r+256).toString(16).slice(1));function oo(r,e=0){return(q[r[e+0]]+q[r[e+1]]+q[r[e+2]]+q[r[e+3]]+"-"+q[r[e+4]]+q[r[e+5]]+"-"+q[r[e+6]]+q[r[e+7]]+"-"+q[r[e+8]]+q[r[e+9]]+"-"+q[r[e+10]]+q[r[e+11]]+q[r[e+12]]+q[r[e+13]]+q[r[e+14]]+q[r[e+15]]).toLowerCase()}var _n=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),tr={randomUUID:_n};function En(r,e,o){if(tr.randomUUID&&!e&&!r)return tr.randomUUID();r=r||{};let a=r.random||(r.rng||er)();if(a[6]=a[6]&15|64,a[8]=a[8]&63|128,e){o=o||0;for(let n=0;n<16;++n)e[o+n]=a[n];return e}return oo(a)}var ve=En;function ao(r){let e,o,a,n,f,d,g;return s(),{feed:p,reset:s};function s(){e=!0,o="",a=0,n=-1,f=void 0,d=void 0,g=""}function p(l){o=o?o+l:l,e&&kn(o)&&(o=o.slice(no.length)),e=!1;let x=o.length,T=0,w=!1;for(;T<x;){w&&(o[T]===`
`&&++T,w=!1);let P=-1,C=n,M;for(let _=a;P<0&&_<x;++_)M=o[_],M===":"&&C<0?C=_-T:M==="\r"?(w=!0,P=_-T):M===`
`&&(P=_-T);if(P<0){a=x-T,n=C;break}else a=0,n=-1;i(o,T,C,P),T+=P+1}T===x?o="":T>0&&(o=o.slice(T))}function i(l,x,T,w){if(w===0){g.length>0&&(r({type:"event",id:f,event:d||void 0,data:g.slice(0,-1)}),g="",f=void 0),d=void 0;return}let P=T<0,C=l.slice(x,x+(P?w:T)),M=0;P?M=w:l[x+T+1]===" "?M=T+2:M=T+1;let _=x+M,j=w-M,h=l.slice(_,_+j).toString();if(C==="data")g+=h?"".concat(h,`
`):`
`;else if(C==="event")d=h;else if(C==="id"&&!h.includes("\0"))f=h;else if(C==="retry"){let A=parseInt(h,10);Number.isNaN(A)||r({type:"reconnect-interval",value:A})}}}var no=[239,187,191];function kn(r){return no.every((e,o)=>r.charCodeAt(o)===e)}async function*rr(r){let e=r.getReader();try{for(;;){let{done:o,value:a}=await e.read();if(o)return;yield a}}finally{e.releaseLock()}}async function so(r,e){let{onMessage:o,...a}=e,n=await fetch(r,a);if(!n.ok){let s=await n.json().catch(()=>({}));throw console.log("error",s),new Error(pe(s)?`${n.status} ${n.statusText}`:JSON.stringify(s))}let f=ao(s=>{s.type==="event"&&o(s.data)}),d=!1,g="";for await(let s of rr(n.body)){if(g=new TextDecoder().decode(s),g.indexOf("wss_url")>-1){d=!0;break}f.feed(g)}if(d){let s=JSON.parse(g).wss_url,p=new WebSocket(s);p.onmessage=i=>{let l=JSON.parse(i.data),x=atob(l.body);if(x.indexOf("data:")===0){let T=x.slice(5);T.trim()==="[DONE]"&&p.close(),o(T)}else throw p.close(),new Error("Unknown message format: "+x)}}}async function io(r,e){let{onMessage:o,...a}=e,n=await fetch(r,a);if(!n.ok){let f=await n.json().catch(()=>({}));throw console.log("error stream",f),new Error(pe(f)?`${n.status} ${n.statusText}`:JSON.stringify(f))}for await(let f of rr(n.body)){let d=new TextDecoder().decode(f);o(d)}o("[DONE]")}var sr=X(ne());function On(r,e,o){let a=0,n=r.indexOf(e);for(;n!==-1&&(a++,a!=o);)n=r.indexOf(e,n+1);return{count:a,index:n}}function ie(r,e){let o='{"start_time"',{count:a,index:n}=On(r,o,e.numberOfBulletPoints+1);return a>e.numberOfBulletPoints&&(r=r.substring(0,n),r=r.substring(0,r.lastIndexOf(","))+"]"),r}var uo=X(lo()),or=class{getAnswer(e){if(e&&e.seed&&e.difficulty&&e.user_agent){let o=e.seed,a=e.user_agent,n=e.difficulty;if(typeof o=="string"&&typeof n=="string")return"gAAAAAB"+this._generateAnswer(o,n,a)}return null}_generateAnswer(e,o,a){let n=Math.floor(Math.random()*2001+1e3),f=this._getConfig(n,a),d=o.length;for(let g=0;g<1e5;g++){f[3]=g;let s=JSON.stringify(f),p=btoa(s);if(this._hashFunction(e,p).substring(0,d)<=o)return p}}_getConfig(e,o){let a=new Date,n=8*60*60*1e3,d=new Date(a.getTime()+n).toUTCString();return[e,d,null,0,o]}_hashFunction(e,o){let a=e+o;return(0,uo.sha3_512)(a)}},fo=or;var ar="",Se,nr;async function Mn(r,e){if(r&&r!==ar){ar=r;try{let a=(await sr.default.storage.local.get("conversationIds")).conversationIds;if(a&&a.length>0)for(let n=0;n<a.length;n++)await br(e,a[n],{is_visible:!1});a=[ar],await sr.default.storage.local.set({conversationIds:a})}catch(o){console.log(o)}}}var le={currentConversationId:"",abortController:void 0,abort:function(){try{Se&&(console.log("ABORTED REQUEST"),Se.abort())}catch(r){console.log("ABORT ERROR",r)}nr?nr({type:"answer",event:"DONE",overallSummaryDone:!0}):console.log("NO CALLBACK")},getResponse:async function(r,e,o,a,n,f,d,g,s,p="",i=null,l=0,x,T=!1,w="",P=0){let M=await(await fetch("https://chatgpt.com/backend-api/sentinel/chat-requirements",{headers:{Authorization:`Bearer ${f}`,"Content-Type":"application/json"},body:JSON.stringify({conversationMode:{kind:"primary_assistant"}}),method:"POST"})).json();if(await Mn(g,f),nr=x,d>=n.length){if(a!==G.Chat){let h={type:"answer",event:"DONE",internalSummaryMode:a};(a==="merge articles"||a==="merge tldr")&&(h.overallSummaryDone=!0),x(h)}else x({type:"CHAT_RESPONSE",event:"DONE",internalSummaryMode:a});return}let _="",j=null;T?j={action:"continue",supports_modapi:!0,model:e,parent_message_id:p==""?ve():p}:(console.log("model name",e,e&&e.indexOf("gpt-4")>-1),j={action:"next",supports_modapi:!0,messages:[{id:ve(),role:"user",content:{content_type:"text",parts:[n[d].prompt]}}],model:e,arkose_token:null,parent_message_id:p==""?ve():p}),T=!1,g&&(j.conversation_id=g),Se=new AbortController,r.onDisconnect.addListener(()=>{console.log("port disconnected"),Se.abort()});try{console.log("fetching");let h=new fo,A=null;M?.proofofwork?.required&&(A=h.getAnswer({seed:M.proofofwork.seed,difficulty:M.proofofwork.difficulty,user_agent:navigator.userAgent})),await so("https://chatgpt.com/backend-api/conversation",{method:"POST",signal:Se.signal,headers:{"Content-Type":"application/json",Authorization:`Bearer ${f} `,"Openai-Sentinel-Chat-Requirements-Token":M.token,"Openai-Sentinel-Proof-Token":A},body:JSON.stringify(j),onMessage(O){if(O=O.trim(),O==="[DONE]"){if(console.log("(DONE)"),T){setTimeout(()=>{le.getResponse(r,e,o,o,n,f,d,g,s,p,i,l,x,!0,_,P+1)},3e3);return}if(s?.trim()===""&&_?.trim()=="")throw new Error("The response is empty");if(a==="article"||a==="tldr"||a==="Custom prompt"&&i?.executePromptOption==="max")_=_.replace(/"/g,'\\"'),s=`${s===""?"[":s+","}{"start_time":${n[d].start_time},"end_time":${n[d].end_time},"text": "
${_}"}`;else if(a==="Custom prompt"&&i?.executePromptOption==="custom"){let I=l+parseInt(i.numberOfMinutes)*60;I>n[d].end_time&&d===n.length-1&&(I=n[d].end_time),s=`${s===""?"[":s+","}{"start_time":${l},"end_time":${I},"text": "
${_.replace(/"/g,'\\"')}"}`,l=I}else a==="merge articles"||a==="merge tldr"?s='{"text":"'+_.replace(/"/g,'\\"')+'"}':s=s+`
`+ie(_,n[d]);return setTimeout(function(){le.getResponse(r,e,o,o,n,f,d+1,g,s,p,i,l,x)},3e3)}let y={};try{y=JSON.parse(O)}catch(I){console.error(I);return}if(y&&y.message){p=y.message?.id;let I=y.message?.content?.parts?.[0];if(_=(w||"")+I,g=y.conversation_id,_)if(a==="merge articles"||a==="merge tldr")x({type:"answer",text:s+'{"text":"'+_.replace(/"/g,'\\"'),messageId:y.message.id,conversationId:y.conversation_id,isHierarchicalSummary:!0,internalSummaryMode:a});else if(a==="article"||a==="tldr"||a==="Short Video"||a==="Custom prompt"&&i?.executePromptOption==="max")x({type:"answer",text:`${s===""?"[":s+","}{"start_time":${n[d].start_time},"end_time":${n[d].end_time},"text": "
${_.replace(/"/g,'\\"')}`,messageId:y.message.id,conversationId:y.conversation_id,isSummaryBreakdown:n.length>1,isHierarchicalSummary:n.length>1,internalSummaryMode:a});else if(a==="Custom prompt"&&i?.executePromptOption==="custom"){let L=l+parseInt(i.numberOfMinutes)*60;L>n[d].end_time&&d===n.length-1&&(L=n[d].end_time),x({type:"answer",text:`${s===""?"[":s+","}{"start_time":${l},"end_time":${L},"text": "
${_.replace(/"/g,'\\"')}`,messageId:y.message.id,conversationId:y.conversation_id,isSummaryBreakdown:n.length>1,isHierarchicalSummary:n.length>1,internalSummaryMode:a})}else a==="continue summary"?x({type:"answer",text:s+_,messageId:y.message.id,conversationId:y.conversation_id,internalSummaryMode:a}):a===G.Chat?(_=ie(_,n[d]),x({type:"CHAT_RESPONSE",text:s+_,messageId:y.message.id,conversationId:y.conversation_id,internalSummaryMode:a})):(_=ie(_,n[d]),x({type:"answer",text:s+(s.length>0?`
%SEPARATOR%`:"")+_,messageId:y.message.id,conversationId:y.conversation_id,internalSummaryMode:a}));y.message.metadata&&y.message.metadata.finish_details&&y.message.metadata.finish_details.type==="max_tokens"&&(T=!0)}else if(y&&y.message==null&&y.error!=null){console.log("ERROR",y.error);let I=y.error;if(y.error.indexOf("Our systems have detected unusual activity from your system")>-1)I="There is an error with executing summarization. If you are using ChatGPT Plus, please try another free ChatGPT account or Gemini or you can use our payed version that provides the best output with GPT-4.",x({type:"answer",error:I,internalSummaryMode:a});else if(!y.error.indexOf("network error")>-1)return}else{if(y?.type=="conversation_detail_metadata"||y?.type=="title_generation")return;if(!y?.moderation_response){let I={type:"answer",event:"DONE",internalSummaryMode:a};(a==="merge articles"||a==="merge tldr")&&(I.overallSummaryDone=!0),x(I)}}}})}catch(h){if(console.log("ERROR",h),h.message.indexOf("message_length_exceeds_limit")>-1&&d>0)console.log("truncating prompt"),n[d].prompt=n[d].prompt.substring(0,n[d].prompt.length-200),le.getResponse(r,e,o,o,n,f,d,g,s,p,i,l,x);else throw h}return g}};var co=X(ne());var po={getResponse:async function(r,e,o,a,n,f,d,g,s,p="",i){let l=0;for(let x=0;x<n.length;x++){let T=n[x].prompt,w={model:e||"gpt-3.5-turbo-16k",messages:[{role:"user",content:T}],stream:!1},P=await co.default.storage.local.get("chatgpt_apikey"),C=await fetch(`
            https://api.openai.com/v1/chat/completions`,{method:"post",headers:{"Content-Type":"application/json",Authorization:`Bearer ${P.chatgpt_apikey}`},body:JSON.stringify(w)});if(!C.ok){let j=await C.json().catch(()=>({}));throw new Error(pe(j)?`${C.status} ${C.statusText}`:JSON.stringify(j))}let M=await C.json().catch(()=>({})),_="";if(M&&M.choices&&M.choices.length>0&&M.choices[0].content?_=M.choices[0].content:M&&M.choices&&M.choices.length>0&&M.choices[0].message?_=M.choices[0].message.content:M&&M.message&&(_=M.message.content),o==="article"||o==="tldr"||o==="Custom prompt"&&i?.executePromptOption==="max")s=`${s===""?"[":s+","}{"start_time":${n[x].start_time},"end_time":${n[x].end_time},"text": "
${_.replace(/"/g,'\\"')}"}`;else if(o==="Custom prompt"){let j=l+parseInt(i.numberOfMinutes)*60;j>n[x].end_time&&x===n.length-1&&(j=n[x].end_time),s=`${s===""?"[":s+","}{"start_time":${l},"end_time":${j},"text": "
${_.replace(/"/g,'\\"')}"}`,l=j}else o==="bulletpoints"||o==="layeredbulletpoints"?(s=s+`
`+ie(_,n[x]),r.postMessage({text:s,isSummaryBreakdown:n.length>1})):o==="continue summary"?s=s+`
`+ie(_,n[x]):(o==="merge articles"||o==="merge tldr")&&(s='{"text":"'+_.replace(/"/g,'\\"')+'"}');r.postMessage({text:s,isSummaryBreakdown:n.length>1,overallSummaryDone:n.length===1})}r.postMessage({event:"DONE"})}};var ir={["article"]:`
    Act as the author and provide a comprehensive detailed article in {language}
        in markdown format that has a H1 main title(example "# <{training_shot}> ") and broken down into H2 subtitles (example "## <{training_shot}> ") for the following transcript
You must follow the rules:
  {max_words}
- Write the article in markdown format
- Create a main title for the article as markdown H1 and break the article into subtitles where each subtitle is markdown H2
- Article must be in {language}
- summary should be informative and act as a replacement for the original transcript to the point that the user doesn't have to go back to read the transcript
- Summary should not mention the author or speaker at all should act as your independent writing without referencing the original transcript or speaker. 
- You can use bullet points within the article
Transcript:
`,[G.Chat]:`Provide a one or two SHORT sentences answer in {language} for the following line based on the previous transcript
`,["layeredbulletpoints"]:`Act as the author and provide exactly ONE key point in {language}
    } and provide a summary for the key point
    The output should be a json array and summary of the key point must be in the json format:
    { "start_time": {start_time}, "title": <title>, "summary": <summary>}
    Example: { "start_time": "10.5", "title": "{training_shot}", "summary": <summary>}
    You must follow the rules:
    1. The output is not more than ONE key point
    2. The output is a valid json array that can pass JSON.parse and nothing is provided before the array
    3. Fix any errors in the json structure like missing commas, missing double quotes, etc.
    4. Wrap json keys with double quotes and don't use put any single quotes or double quotes inside the values. 
    5. The output json is not wrapped in any other json structure like { "data": <output json >}.
    6. The title is at least 5 words and at most 15 words.
    7. The summary should be as detailed as needed to make the summary comprehensive.
    8. Both the title and the summary are in {language}
    9. Summary should not mention the author or speaker at all should act as an independent writing.`,["tweets"]:`Summarize the following transcript as a {number_of_replies} in {language} in json format in the form of {tweets_format}
You must follow the rules:
        - Output Must be in the json format specified above
        {number_of_replies_rule}
        - Tweet should be less than 280 characters
        - use emojis and hashtags
        {tweet_thread_rules}
Transcript:
`,["Short Video"]:`Summarize the following transcript as a smaller video transcript in {language}
    You must follow the rules:
              - The answer should be a script for a standalone youtube video and shouldn't have any mention of the original transcript
              - The answer is just the script which means I can convert it as is to audio without modifications.
              -  Don't add any fillers, titles or context in the script so no words like "Intro, Introduction, transcript, conclusion or speaker" should be used in the answer
              - The transcript must be in {language}
              - The transcript must be informative and can be used as a script for a youtube video
              - The transcript must be less than 100 words.
    Transcript: 
    `,["tldr"]:`Act as the author and provide a tldr one paragraph summary in {language} that is less than 100 words of the following transcript
You must follow the rules: 
- tldr should be informative and act as a replacement for the original transcript to the point that the user won't know there is an original transcript this means the output shouldn't have words like "speaker", "transcript", "author"
- tldr should not mention the author or speaker at all should act as an independent writing.
- tldr should be precise and to the point.
Transcript:
`,["bulletpoints"]:`Act as the author and provide a one sentence summary in {language} that is less than 100 words of
  the following transcript
and make the output only in the format of a json array of one element [{ "start_time": {start_time} , "bullet_point": <summary>}]
You must follow the rules: 
- summary should be informative and act as a replacement for the original transcript to the point that the user won't know the
re is an original transcript this means the output shouldn't have words like "speaker", "transcript", "author"
- summary should not mention the author or speaker at all should act as an independent writing.
- summary should be precise and to the point.
- summary must be in {language}
- summary can be put as a SINGLE bullet point in a list of bullet points.
transcript`,[G.Transcript]:`Given a transcript in the form of:
  { text: <text>, start_time: <start_time>}
               Translate the transcript into {language}
                and provide the translation in the same format as the input transcript. 
                If the text is already in the requested language or language is auto, then just return the transcript as is.
    Transcript:`};var lr="accessToken",ur=new mo.default(10*1e3),_e="";function In(r){let e=[];for(let o=0;o<r.length;){let a="",n=r[o].start_time,f=0;for(;f<8&&o+f<r.length&&(a+r[o+f].text).length<=500;)a+=r[o+f].text,f++;e.push({text:a,start_time:n}),o+=f}return e}function Pn(r,e,o,a,n){let f=[],d=Math.ceil(r.length/e),g=Math.ceil(r.length/d);if(n&&n?.executePromptOption==="custom"){let s=parseInt(n.numberOfMinutes),p=parseFloat(r[0].start_time),i=0;for(let l=0;l<r.length;l++)if(r[l].start_time-p>s*60||l===r.length-1||l-i===g){p=p+s*60;let x=r.slice(i,l);i=l;let T=x.map(w=>({text:w.text,start_time:w.start_time}));f.push(T)}}else if(a=="bulletpoints"||a=="layeredbulletpoints"){let s=o!=Qr,p=r[r.length-1].start_time/60;p>80&&s==!1&&(o=Math.ceil(p/to)),o=Math.min(eo,o),console.log("number of requested bullet points after processing: "+o);let i=Math.ceil(r.length/o),l=i;s&&(l=Math.min(i,e));for(let x=0;x<r.length;x+=i){let T=Math.min(x+l,r.length),w=r.slice(x,T),P=w.map(C=>C.text).join(" ");f.push([{text:P,start_time:w[0].start_time}])}}else for(let s=0;s<r.length;s+=g){let i=r.slice(s,Math.min(s+g,r.length)).map(l=>({text:l.text,start_time:l.start_time}));f.push(i)}return f}function Cn(r,e,o,a,n,f,d,g){let s=[],p=a;p!==-1&&(p=Math.max(50,Math.ceil(a/r.length)));for(let i=0;i<r.length;i++){let l="";e=="Custom prompt"?l=d&&d.prompt?d.prompt:"":l=ir[e];let x=f==te.Auto?"the same language as the transcript":f+" language";l=l.replaceAll("{language}",x);let T=function(w,P){let C=[],M=Math.ceil(w.length/P);console.log("itemsPerMergedItem",M);for(let _=0;_<w.length;_+=M){let j=[],h=[];for(let A=0;A<M&&_+A<w.length;A++)j.push(w[_+A].text),h.push(w[_+A].start_time);C.push({item:j.join(" "),start_time:h[0]})}return C};if(e=="tldr"){let w=r[i].map(P=>P.text).join(" ");l=`${l}
                ${w}
                tldr:`,s.push({prompt:l})}else if(e=="tweets"){let w=r[i].map(C=>C.text).join(" ");console.log("numberOfTweetReplies",n),l=l.replaceAll("{tweets_format}",n==0?'{"tweet": <tweet>}':'an array without wrapper like [{"tweet": <tweet1>}, {"tweet": <tweet2>, ...}]'),l=l.replaceAll("{number_of_replies}",n==0?"tweet":`tweet with ${n} replies`),l=l.replaceAll("{number_of_replies_rule}",n>0?"- The number of tweet replies must be exactly "+n:"");let P=n==0?"- The tweet should be the summary of the whole transcript":`- IMPORTANT: DON'T add any prefix or suffix to the tweets like "Main Tweet:" or "Tweet 1:" or "Reply 1:" or "TLDR:" or "Summary:" or "1/5" or any other prefix or suffix'
       - The first tweet should be the main tweet and it should be a tl;dr; and the rest should be replies to the main tweet that provide more details
       - Each tweet should be a reply to the previous tweet
       - Each tweet should be a continuation of the previous tweet`;l=l.replaceAll("{tweet_thread_rules}",P),l=`${l}
      ${w}
      tweets:`,s.push({prompt:l})}else if(e=="Short Video"){let w=r[i].map(P=>P.text).join(" ");s.push({prompt:`Summarize the following transcript as a smaller video transcript in ${f==te.Auto?"the same language as the transcript":f+" language"}
You must follow the rules:
      - The answer should be a script for a standalone youtube video and shouldn't have any mention of the original transcript
        - The answer is just the script which means I can convert it as is to audio without modifications.
          - Don't add any fillers, titles or context in the script so no words like "Intro, Introduction, transcript, conclusion or speaker" should be used in the answer
         ${i==0?"- The transcript should have an intro to say what the script is about":"- The transcript should be a continuation of the previous answer"}
      - The transcript must be in ${f==te.Auto?"the same language as the transcript":f+" language"}
      - The transcript must be informative and can be used as a script for a youtube video

Transcript: ${w}
New Transcript: `})}else if(e=="article"){let w=r[i].map(P=>P.text).join(" ");l=l.replaceAll("{training_shot}",Ft[f]),l=l.replaceAll("{max_words}",p!=-1?"- max number of words is: "+p:""),l=`${l}
            ${w}
            article:`,s.push({prompt:l})}else if(e==G.Chat){let w=r[i].map(P=>P.text).join(" ");l=l.replaceAll("{training_shot}",Ft[f]),l=l.replaceAll("{max_words}",p!=-1?"- max number of words is: "+p:""),l=`${l}
            ${w}
${g}
`,s.push({prompt:l})}else if(e=="bulletpoints"||e=="layeredbulletpoints")l=l.replaceAll("{start_time}",r[i][0].start_time),l=l.replaceAll("{training_shot}",Ft[f]),l=`${l}
            ${JSON.stringify(r[i])}
            bullet points as json array:`,s.push({prompt:l});else if(e===G.Chapters)s.push({prompt:`Given a transcript in the form of:
  { text: <text>, start_time: <start_time>}
                provide the minimum number of chapter titles that represent the given transcript in ${f} language in the format of
  { start_time: <start_time>, chapter_title: <chapter_title>}
                Rules to follow:
  1. Provide chapter titles only for the key points of the transcript with each chapter represents a full topic.
                2. The output is a valid json array that can pass JSON.parse and nothing is provided before the array
  3. json objects in the output are sorted in chronological order by "start_time" property.
                4. Fix any errors in the json structure like missing commas, missing double quotes, etc.
                5. The output json is not wrapped in any other json structure like { "data": <output json >}
  6. The start time is in seconds and is a valid number
  7. Wrap json keys with double quotes and don't use put any single quotes or double quotes inside the values.
                ${i<r.length-1?"8. IMPORTANT: Assume that there will be chapters after the last one after I give you the next input":""}
  Transcript: 
                ${JSON.stringify(r[i])}
  Chapters: `});else if(e===G.Transcript)l=`${l}
        ${JSON.stringify(r[i])}
        Translated Transcript:`,s.push({prompt:l});else if(e=="Custom prompt"&&d){let w=r[i].map(P=>P.text).join(" ");s.push({prompt:`${l}
  Transcript: 
                ${w}
  Summary: `})}else s.push({prompt:`Given a transcript in the form of:
  { text: <text>, start_time: <start_time>}
                provide the minimum number of chapter titles that represent the given transcript in ${f} language in the format of
  { start_time: <start_time>, chapter_title: <chapter_title>}
                Rules to follow:
  1. The output is a valid json array that can pass JSON.parse and nothing is provided before the array
  2. json objects in the output are sorted in chronological order by "start_time" property.
                3. Fix any errors in the json structure like missing commas, missing double quotes, etc.
                4. The output json is not wrapped in any other json structure like { "data": <output json >}
  5. The start time is in seconds and is a valid number
  6. Wrap json keys with double quotes and don't use put any single quotes or double quotes inside the values.
  Transcript: 
                ${JSON.stringify(r[i])}
  Chapters: `});s[s.length-1].start_time=r[i][0]?.start_time,s[s.length-1].end_time=r[i][r[i].length-1]?.start_time}return s}async function Nn(){if(ur.get(lr))return ur.get(lr);let r=await fetch("https://chatgpt.com/api/auth/session");if(r.status===403)throw new Error("CLOUDFLARE");let e=await r.json().catch(()=>({}));if(!e.accessToken)throw new Error("UNAUTHORIZED");return ur.set(lr,e.accessToken),e.accessToken}function go(){le.abort()}async function Ee(r,e,o,a,n=0){let f=[],d=null;try{d=JSON.parse(e.customPrompt)}catch{d=e.customPrompt}if(e.summaryMode!=="merge articles"&&e.summaryMode!=="merge tldr"&&e.summaryMode!=="continue summary"){let s=[];e.transcript.length>0&&(s=JSON.parse(e.transcript)),e.summaryMode===G.Transcript&&(s=In(s));let p=Pn(s,o,e.maxBulletPointsPerTranscript,e.summaryMode,e.summaryMode=="Custom prompt"&&e.customPrompt?d:null);if(f=Cn(p,e.summaryMode,e.maxBulletPointsPerTranscript,e.numberOfWordsPerArticle,e.numberOfTweetReplies,e.language,"Custom prompt"&&e.customPrompt?d:null,e.message),e.summaryMode===G.Chat&&e.transcript==""){let i=ir[G.Chat],l=e.language==te.Auto?"the same language as the conversation":e.language+" language";i=i.replaceAll("{language}",l),i+=`
${e.message}
`,f=[{prompt:i}]}}else e.summaryMode==="merge articles"?f.push({prompt:`Can you merge these transcripts as a single article in ${e.language==te.Auto?"the same language as the transcript":e.language+" language"} that has one main title and broken into sections where each section has a subtitle.
Rules to follow:
  - Summary must seem like a single article and it mustn't show that it came from different transcripts. So the output shouldn't have things like "transcript", "First transcript", "second transcript", "the transcript" or anything similar
    - summary should be very detailed, engaging and entertaining and act as a replacement for the transcript.It shouldn't remove information from the original transcript.
      - Summary should not mention the author or speaker at all and should act as your independent writing. 
    - Write the article in markdown format and make the titles as small headers like H2.
    - You can use bullet points or titles within the article.
    - You can use bold or italic markdown words.
    - You can create a main title for the article if possible and format it as H1.

    Transcripts: 
${e.transcript}
  Summary: `}):e.summaryMode=="merge tldr"?f.push({prompt:`Can you merge these transcripts as a single tldr in ${e.language==te.Auto?"the same language as the transcript":e.language+" language"} that summarizes the while transcript and provides a tldr
Rules to fillow:
  - Summary must seem like a single article and it mustn't show that it came from different transcripts. So the output shouldn't have things like "transcript", "First transcript", "second transcript", "the transcript" or anything similar
    - Summary should not mention the author or speaker at all and should act as your independent writing.

      Transcripts: 
${e.transcript}
  Summary: `}):e.summaryMode=="continue summary"&&f.push({prompt:`continue the summary exactly from you left off in ${e.language==te.Auto?"the same language as the transcript":e.language+" language"} 
If the summary is already done, respond only with ${ro}
Current summary: 
    ${e.transcript}
  Continuation:
  `});let g=await Nn();e.model?_e=e.model:_e=_e||await wr(g);try{e.summarizationProvider==="chatgpt api"?await po.getResponse(r,_e,e.summaryMode,e.summaryMode,f,g,0,e.conversationId,"","",e.customPrompt?d:null):await le.getResponse(r,_e,e.summaryMode,e.summaryMode,f,g,0,e.conversationId,"",e.parentMessageId||"",e.customPrompt?d:null,0,a)}catch(s){if(console.log(s,s.code,s.message),s.message.indexOf("The message you submitted was too long")>-1||s.message.indexOf("The response is empty")>-1||s.message.indexOf("context_length_exceeded")>-1)if(e.summaryMode!=="merge articles")if(o>1)console.log("retrying with smaller transcript",Math.floor(o/2)),Ee(r,e,Math.floor(o/2),a,n+1);else{let p="Cannot generate overall summary for this transcript because partial summary is too big, descrease summary duration from settings.";r.postMessage({type:"answer",text:'{"text":"'+p+'"}'}),setTimeout(()=>{r.postMessage({type:"answer",event:"DONE",overallSummaryDone:!0})},1e3)}else if(e.transcript=e.transcript.substring(0,e.transcript.length-Math.min((n+1)*50,3e3)),n<5)Ee(r,e,Math.floor(o/2),a,n+1);else{let p="Cannot generate overall summary for this transcript because partial summary is too big.";r.postMessage({type:"answer",text:'{"text":"'+p+'"}'}),setTimeout(()=>{r.postMessage({type:"answer",event:"DONE",overallSummaryDone:!0})},1e3)}else if(s.message.indexOf("Only one message at a time")>-1)setTimeout(()=>{Ee(r,e,Math.floor(o/2),a,n+1)},2e3);else throw s}}var oe=X(ne());var jn="1015583372301-ifdpu597snn6mtkveq81da9fsk3jmof7.apps.googleusercontent.com",Dn="https://www.googleapis.com/auth/userinfo.email",me=async(r,e)=>{let o=oe.default.identity.getRedirectURL(),a=`https://accounts.google.com/o/oauth2/auth?client_id=${jn}&access_type=offline&response_type=code&redirect_uri=${encodeURIComponent(o)}&scope=${encodeURIComponent(Dn)}&prompt=consent`,n=await oe.default.identity.launchWebAuthFlow({interactive:r,url:a});if(n){let d=new URL(n).searchParams.get("code"),s=await(await fetch("https://www.youtubedigest.app/api/exchange",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({authCode:d})})).json(),p=s.accessToken,i=s.refreshToken;if(p){let l=p,T=await(await fetch(`https://www.googleapis.com/oauth2/v2/userinfo?access_token=${l}`)).json(),w=T.email;await oe.default.storage.local.set({gAuth:{gAccessToken:l,gRefreshToken:i,userEmail:w}}),e&&e(l,T)}else console.log("Error signing in: access token not found in response URL",n,s)}else console.log("Error signing in: user did not grant permission")},W=async(r,e,o,a,n=!1)=>{let g=n?async i=>{console.log("executing stream request"),await io(r,{method:e,headers:{"Content-Type":"application/json",Authorization:"Bearer "+i},body:JSON.stringify(o),onMessage:l=>{a(l)}})}:async i=>{let l={method:e,headers:{"Content-Type":"application/json",Authorization:"Bearer "+i}};o&&(l.body=JSON.stringify(o));let x=await fetch(r,l),T=await x.json();if(T&&T.error)throw console.log("error in executing request",T.error),{status:x.status,error:T.error};a&&a(T)},s=null,p=null;try{if(s=await oe.default.storage.local.get("gAuth"),s&&s.gAuth){p=s.gAuth.gAccessToken,await g(p);return}}catch(i){if(console.log("Error in excuting summarization",JSON.stringify(i)),i.status===403||i.status===401||i.error==="UNAUTHORIZED")console.log("failed in getting user identity from storage",i);else if(i&&i.message&&i.message.indexOf("NoCredits")>-1)console.log("no credits",i),a({error:i});else if(i&&i.message&&i.message.indexOf("UNAUTHORIZED")>-1)console.log("failed in getting user identity from storage");else throw console.log("rethrowing error",i),i}try{if(s&&s.gAuth){let i=s.gAuth.gRefreshToken,T=(await(await fetch("https://www.youtubedigest.app/api/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:i})})).json()).accessToken;if(T){s.gAuth.gAccessToken=T,await oe.default.storage.local.set({gAuth:s.gAuth}),console.log("executing request with new access token after refresh"),await g(T);return}}}catch(i){console.log("failed in getting user identity after refresh",i)}try{await me(!1,async i=>await g(i))}catch(i){console.log("failed in getting user identity",i)}p||await me(!0,g)},ho=async r=>{let e=null,o=null;try{if(e=await oe.default.storage.local.get("gAuth"),e&&e.gAuth){o=e.gAuth.gAccessToken,r(o,e.gAuth);return}}catch(a){if(console.log("failed in getting user identity from storage",a),a.status===403||a.status===401||a.error==="UNAUTHORIZED")console.log("failed in getting user identity from storage",a);else throw a}try{if(e&&e.gAuth){let a=e.gAuth.gRefreshToken,d=(await(await fetch("https://www.youtubedigest.app/api/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:a})})).json()).accessToken;if(d){e.gAuth.gAccessToken=d,await oe.default.storage.local.set({gAuth:e.gAuth}),console.log("executing request with new access token after refresh"),r(d,e.gAuth);return}}}catch(a){console.log("failed in getting user identity after refresh",a)}try{console.log("silent sign in"),await me(!1,r)}catch(a){console.log("failed in getting user identity",a)}o||await me(!0,r)};function Bn(r){let e=[];for(let o=0;o<r.length;){let a="",n=r[o].start_time,f=0;for(;f<8&&o+f<r.length&&(a+r[o+f].text).length<=500;)a+=r[o+f].text,f++;e.push({text:a,start_time:n}),o+=f}return e}function Un(r,e,o,a,n){let f=[],d=Math.ceil(r.length/e),g=Math.ceil(r.length/d);if(n&&n?.executePromptOption==="custom"){let s=parseInt(n.numberOfMinutes),p=parseFloat(r[0].start_time),i=0;for(let l=0;l<r.length;l++)if(r[l].start_time-p>s*60||l===r.length-1||l-i===g){p=p+s*60;let x=r.slice(i,l);i=l;let T=x.map(w=>({text:w.text,start_time:w.start_time}));f.push(T)}}else{let s=d,p=g;(a==="bulletpoints"||a==="layeredbulletpoints")&&d>o&&(s=Math.min(d,o),p=Math.ceil(r.length/s));for(let i=0;i<r.length;i+=p){let x=r.slice(i,i+g).map(T=>({text:T.text,start_time:T.start_time}));f.push(x)}}return f}async function xo(r,e,o){let a=null;try{a=JSON.parse(e.customPrompt)}catch{a=e.customPrompt}let n=[];e.transcript.length>0&&(n=JSON.parse(e.transcript)),e.summaryMode===G.Transcript&&(n=Bn(n));let f=Un(n,o,e.maxBulletPointsPerTranscript,e.summaryMode,e.summaryMode=="Custom prompt"&&e.customPrompt?a:null);Ln(f,r,a,e,"")}function Ln(r,e,o,a,n){W("https://www.youtubedigest.app/api/summarize","post",{transcripts:r,language:a.language,summaryMode:a.summaryMode,maxBulletPointsPerTranscript:a.maxBulletPointsPerTranscript,numberOfWordsPerArticle:a.numberOfWordsPerArticle,numberOfTweetReplies:a.numberOfTweetReplies,customPrompt:o,videoId:a.videoId,startTime:a.startTime,endTime:a.endTime,forceLoad:a.forceLoad,summaryProvider:a.summarizationProvider},f=>{if(f==="[DONE]"&&e.postMessage({type:"answer",event:"DONE",overallSummaryDone:!0}),f.error&&f.error.message&&f.error.message.indexOf("NoCredits")>-1)console.log("no credits"),e.postMessage({type:"answer",event:"NoCredits"});else{n=n+f;let d=n;(a.summaryMode==="article"||a.summaryMode==="tldr"||a.SummaryMode==="Custom prompt")&&(d=d.endsWith("]")?d:d+'"}]'),e.postMessage({type:"answer",text:d})}},!0)}var de=X(ne()),Wt=async(r,e)=>{let o="ZkwzTm5HV0pFVG15cElDR0c3eWc6MTpjaQ",a=de.default.identity.getRedirectURL(),n=`https://twitter.com/i/oauth2/authorize?response_type=code&client_id=${o}&redirect_uri=${encodeURIComponent(a)}&scope=tweet.write%20users.read%20tweet.read%20offline.access&state=state&code_challenge=challenge&code_challenge_method=plain`,f=await de.default.identity.launchWebAuthFlow({interactive:r,url:n});if(f){let g=new URL(f).searchParams.get("code"),p=await(await fetch("https://www.youtubedigest.app/api/exchange",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({authCode:g,type:"twitter"})})).json(),i=p.accessToken,l=p.refreshToken;if(i){let x=i,w=await(await fetch(`https://www.youtubedigest.app/api/twitter/user?accessToken=${i}`)).json();await de.default.storage.local.set({twitterAuth:{twitterAccessToken:x,twitterRefreshToken:l,username:w.data.username,id:w.data.id,name:w.data.name}}),e&&e(x,w)}else console.log("Error signing in: access token not found in response URL",f,p)}else console.log("Error signing in: user did not grant permission")},yo=async(r,e,o,a)=>{let n=async g=>{let s={method:e,headers:{"Content-Type":"application/json",Authorization:"Bearer "+g}};o&&(s.body=JSON.stringify(o));let p=await fetch(r,s),i=await p.json();if(i&&i.error)throw console.log("error in executing request",i.error),{status:p.status,error:i.error};a&&a(i)},f=null,d=null;try{if(f=await de.default.storage.local.get("twitterAuth"),f&&f.twitterAuth){d=f.twitterAuth.twitterAccessToken,await n(d);return}}catch(g){if(console.log("failed in getting user identity from storage",g),g.status===403||g.status===401||g.error[0].indexOf("Unauthorized")!==-1)console.log("failed in getting user identity from storage",g);else{a(g);return}}try{if(f&&f.twitterAuth){let g=f.twitterAuth.twitterRefreshToken,p=await(await fetch("https://www.youtubedigest.app/api/refresh",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:g,type:"twitter"})})).json(),i=p.accessToken,l=p.refreshToken;if(console.log("refreshed token"),i){f.twitterAuth.twitterAccessToken=i,f.twitterAuth.twitterRefreshToken=l,await de.default.storage.local.set({twitterAuth:f.twitterAuth}),console.log("executing request with new access token after refresh"),await n(i);return}}}catch(g){if(console.log("failed in getting user identity after refresh",g),g.status===403||g.status===401||g.error[0].indexOf("Unauthorized")!==-1)console.log("failed in getting user identity from storage",g);else{a(g);return}}try{await Wt(!1,async g=>await n(g))}catch(g){console.log("failed in getting user identity",g)}d||await Wt(!0,n)};var ke="accessToken",Oe=new wo.default(10*1e3),Fn=400,$n=30,Gn=4e3,qt,ge={};async function Ao(){if(Oe.get(ke))return Oe.get(ke);let r=await fetch("https://chatgpt.com/api/auth/session");if(r.status===403)throw new Error("CLOUDFLARE");let e=await r.json().catch(()=>({}));if(!e.accessToken)throw new Error("UNAUTHORIZED");return Oe.set(ke,e.accessToken),e.accessToken}U.default.runtime.onConnect.addListener(async r=>{if(r.name==="openAITab"){let e=r.sender.tab.id,o=-1;try{o=await U.default.storage.local.get("chatgptTabId")}catch(a){console.log(a)}if(!o||e!==o.chatgptTabId)return;qt=r,r.postMessage({type:"CALL_METHOD",methodName:"HANDLE_TAB_CREATED"}),r.onMessage.addListener(async a=>{ge[a.portName]&&ge[a.portName].postMessage(a.answer)}),r.onDisconnect.addListener(()=>{qt=void 0});return}ge[r.name]=r,r.onDisconnect.addListener(()=>{for(let e in ge)if(ge[e]===r){delete ge[e];break}}),r.onMessage.addListener(async e=>{if(e&&e.type==="FETCH_MODELS"){let o=await Ao(),a=await Yt(o);r.postMessage({type:"MODELS_RESPONSE",models:JSON.stringify(a)})}else if(e.type==="CREAT_CHATGPT_TAB"){let o="https://chat.openai.com/chat",a;try{a=await U.default.storage.local.get("chatgptTabId")}catch(n){console.log(n)}if(a&&a.id)await U.default.tabs.update(a.id,{active:!0});else{let n=await U.default.tabs.query({currentWindow:!0,url:o});n.length>0?(a=n[0],await U.default.tabs.update(a.id,{active:!0})):(a=await U.default.tabs.create({url:o,pinned:!0}),await U.default.storage.local.set({chatgptTabId:a.id}))}}else if(e.type==="ABORT_SUMMARY")go();else if(e.type==="SHARE_SUMMARY")W("https://www.youtubedigest.app/api/sharesummary","post",{summaryMode:e.summaryMode,summary:e.summary,title:e.title,videoId:e.videoId,url:e.url},o=>{r.postMessage({type:"SUMMARY_SHARED",url:o.url})});else if(e.type==="SIGN_IN")await ho((o,a)=>{r.postMessage({type:"SIGNED_IN",email:a.email})});else if(e.type==="TWITTER_SIGN_IN")await Wt(!0,(o,a)=>{r.postMessage({type:"TWITTER_SIGNED_IN",userInfo:a})});else if(e.type==="SILENT_SIGN_IN"){try{let o=await U.default.storage.local.get("gAuth");if(o&&o.gAuth){let a=o.gAuth.userEmail;r.postMessage({type:"SIGNED_IN",email:a});return}}catch(o){console.log("failed in getting user identity from storage",o)}await me(!1,(o,a)=>{r.postMessage({type:"SIGNED_IN",email:a.email})})}else if(e.type=="GET_CREDITS")W("https://www.youtubedigest.app/api/credits","get",null,o=>{r.postMessage({type:"GOT_CREDITS",credits:o.credits})});else if(e.type=="GET_PRICES")W("https://www.youtubedigest.app/api/checkout-session","post",{price_key:e.price_key,email:e.email},o=>{r.postMessage({type:"GOT_PRICES",price_key:o.price_key,url:o.url})});else if(e.type==="GET_CUSTOM_PROMPTS")W("https://www.youtubedigest.app/api/prompts","get",null,o=>{r.postMessage({type:"CUSTOM_PROMPTS_RESPONSE",prompts:o.prompts})});else if(e.type==="CREATE_NEW_PROMPT")W("https://www.youtubedigest.app/api/prompts","post",{title:e.prompt.title,prompt:e.prompt.prompt,numberOfMinutes:e.prompt.numberOfMinutes,executePromptOption:e.prompt?.executePromptOption},o=>{r.postMessage({type:"CREATE_NEW_PROMPT_RESPONSE",status:o.status,prompt:o.prompt})});else if(e.type==="UPDATE_PROMPT")W("https://www.youtubedigest.app/api/prompts","put",{prompt:e.prompt},o=>{r.postMessage({type:"UPDATE_PROMPT_RESPONSE",status:o.status,prompt:o.prompt})});else if(e.type==="DELETE_PROMPT")W("https://www.youtubedigest.app/api/prompts","delete",{prompt:e.prompt},o=>{r.postMessage({type:"DELETE_PROMPT_RESPONSE",success:o.success})});else if(e.type==="GET_VOICE_LANGUAGES")W("http://localhost:3000/api/get_tts?type=languages","get",null,o=>{r.postMessage({type:"VOICE_LANGUAGES_RESULT",languages:o.languages,dialects:o.dialects})});else if(e.type==="GET_VOICES"){let o=`http://localhost:3000/api/get_tts?type=voices&language=${e.language}&dialect=${e.dialect}`;W(o,"get",null,a=>{r.postMessage({type:"VOICE_RESULT",voices:a})})}else if(e.type==="GENERATE_AUDIO")W("http://localhost:3000/api/get_tts?type=generateAudio","post",{content:e.content,voice:e.voice},a=>{r.postMessage({type:"AUDIO_RESULT",resp:a})});else if(e.type==="GENERATE_VIDEO")W("http://localhost:3000/api/tts?type=generateVideo","post",{content:e.content,voice:e.voice},a=>{r.postMessage({type:"VIDEO_RESULT",resp:a})});else if(e.type==="GENERATE_IMAGE")W("http://localhost:3000/api/tts?type=generateImage","post",{content:e.content},a=>{a.index=e.index,r.postMessage({type:"IMAGE_RESULT",resp:a})});else if(e.type==="POST_TWEET")W("https://www.youtubedigest.app/api/hello","get",null,async()=>{let o=await U.default.storage.local.get("gAuth"),a="";o&&o.gAuth&&(a=o.gAuth.gAccessToken),yo("https://www.youtubedigest.app/api/twitter","post",{tweets:e.tweets,gAuth:a},async n=>{r.postMessage({type:"POST_TWEET_RESULT",resp:n})})});else if(e.type==="GENERATE_SHORTS")W("https://www.youtubedigest.app/api/short_videos","post",e.body,a=>{r.postMessage({type:"SHORTS_RESULT",url:a.url})});else if(e.type==="SUMMARY_REQUEST")try{let o=Fn;if(e.summaryMode=="article"||e.summaryMode=="tldr"||e.summaryMode=="Custom prompt"||e.summaryMode=="tweets"||e.summaryMode=="Short Video"?e.summarizationProvider==="chatgpt api"?o=Gn:o=1e3:e.summaryMode==G.Transcript&&(o=$n),qt){console.log("Sending message to OpenAI tab");try{qt.postMessage({type:"CALL_METHOD",methodName:"SUMMARIZE_VIDEO",internalMsg:e,portName:r.name})}catch(a){console.log(a),await Ao()}}else try{e.summarizationProvider==="chatgpt api"||e.summarizationProvider==="gemini"?await xo(r,e,o):await Ee(r,e,o,a=>{r.postMessage(a)})}catch(a){console.error("EXCEPTION",a),r.postMessage({type:"answer",error:a.message}),Oe.delete(ke)}}catch(o){console.error(o),r.postMessage({type:"answer",error:o.message}),Oe.delete(ke)}else e.type=="MEDIUM_PUBLISH"?W("https://www.youtubedigest.app/api/export/medium/publish","post",e.body,a=>{r.postMessage({type:"MEDIUM_PUBLISH_RESULT",resp:a})}):e.type=="MEDIUM_INFO"?W("https://www.youtubedigest.app/api/export/medium","post",{access_token:e.access_token},a=>{r.postMessage({type:"MEDIUM_INFO_RESULT",resp:a})}):console.log("Unknown message type: "+e.type)})});U.default.runtime.onMessage.addListener(async r=>{r.type==="OPEN_OPTIONS_PAGE"&&U.default.runtime.openOptionsPage()});U.default.action?U.default.action.onClicked.addListener(()=>{U.default.runtime.openOptionsPage()}):U.default.browserAction.onClicked.addListener(()=>{U.default.runtime.openOptionsPage()});U.default.runtime.onInstalled.addListener(r=>{r.reason==="install"&&U.default.tabs.create({url:"https://www.youtubedigest.app/landing"})});U.default.runtime.setUninstallURL("https://www.youtubedigest.app/uninstall-feedback").catch(r=>console.error(r));})();
